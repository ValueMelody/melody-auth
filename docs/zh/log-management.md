# 日志管理

Melody Auth 提供了电子邮件、短信和登录活动的日志记录功能。这有助于你监控系统活动、排查问题，并维护用于安全与合规的审计记录。

## 概述

Melody Auth 的日志系统会跟踪三种类型的活动：
- **电子邮件日志**：记录所有发出的邮件（验证、密码重置、多因素认证等）
- **短信日志**：记录为多因素认证和验证发送的所有短信
- **登录日志**：记录用户的身份验证尝试，包括 IP 和地理位置数据

## 启用日志

出于隐私和存储考虑，日志默认是禁用的。你可以在 `server/wrangler.toml` 文件中分别启用它们：

```toml
[vars]
ENABLE_EMAIL_LOG = true
ENABLE_SMS_LOG = true
ENABLE_SIGN_IN_LOG = true
```

## 访问日志

启用日志后，你可以通过管理面板访问日志：

1. 进入管理面板
2. 点击侧边栏导航中的 **“Logs”**
3. 根据已启用的日志类型查看不同的日志

## 清理旧日志

管理面板为每种日志类型提供了一个 “Clean” 按钮，可用于：
- 删除 30 天以前的日志
- 释放数据库存储空间
- 符合数据保留策略的合规要求

**警告：** 日志清理是永久性操作，无法撤销。清理前务必备份数据。

#### 清理日志步骤：
1. 进入管理面板的日志页面
2. 点击所需日志类型的 “Clean” 按钮
3. 在对话框中确认操作
4. 所有 30 天以前的日志将被永久删除

## 最佳实践

### 隐私与合规
- **数据披露**：始终在隐私政策中披露数据收集情况
- **法规合规**：确保符合 GDPR、CCPA 及其他适用法规
- **保留策略**：根据法律要求实施自动清理计划

### 存储管理
- **定期清理**：设置自动清理流程以防止存储过多
- **监控**：监控日志量和存储消耗
- **归档**：如需合规，可在清理前考虑归档重要日志

## S2S API 访问

也可以通过 S2S API 以编程方式访问日志：

- `GET /api/v1/logs/email` - 获取电子邮件日志
- `GET /api/v1/logs/sms` - 获取短信日志
- `GET /api/v1/logs/sign-in` - 获取登录日志
- `DELETE /api/v1/logs/email` - 清理电子邮件日志
- `DELETE /api/v1/logs/sms` - 清理短信日志
- `DELETE /api/v1/logs/sign-in` - 清理登录日志
