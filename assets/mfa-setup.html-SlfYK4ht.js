import{_ as a,c as s,a as n,o as l}from"./app-PWdtMHCu.js";const t={};function i(o,e){return l(),s("div",null,e[0]||(e[0]=[n(`<h1 id="multi-factor-authentication-mfa-setup" tabindex="-1"><a class="header-anchor" href="#multi-factor-authentication-mfa-setup"><span>Multi-Factor Authentication (MFA) Setup</span></a></h1><p>MFA adds an extra layer of security on top of your primary sign-in method. Melody Auth supports Email, OTP (TOTP), and SMS MFA, plus related features such as Passkey, Recovery Codes, and Remember Device.</p><h2 id="configure-mfa-at-the-server-level" tabindex="-1"><a class="header-anchor" href="#configure-mfa-at-the-server-level"><span>Configure MFA at the server level</span></a></h2><p>Configure these environment variables in <code>server/wrangler.toml</code>:</p><div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml"><pre><code class="language-toml"><span class="line"><span class="token comment"># Enforce a specific MFA factor at sign-in</span></span>
<span class="line"><span class="token key property">OTP_MFA_IS_REQUIRED</span><span class="token punctuation">=</span><span class="token boolean">false</span></span>
<span class="line"><span class="token key property">EMAIL_MFA_IS_REQUIRED</span><span class="token punctuation">=</span><span class="token boolean">false</span> <span class="token comment"># requires email provider configured</span></span>
<span class="line"><span class="token key property">SMS_MFA_IS_REQUIRED</span><span class="token punctuation">=</span><span class="token boolean">false</span>   <span class="token comment"># requires SMS provider configured</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Enforce enrollment in at least one allowed MFA factor when all *_IS_REQUIRED=false</span></span>
<span class="line"><span class="token key property">ENFORCE_ONE_MFA_ENROLLMENT</span><span class="token punctuation">=</span><span class="token punctuation">[</span><span class="token string">&#39;otp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">]</span> <span class="token comment"># options: &#39;email&#39;, &#39;otp&#39;, &#39;sms&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Allow Email MFA as backup when the primary factor is unavailable</span></span>
<span class="line"><span class="token key property">ALLOW_EMAIL_MFA_AS_BACKUP</span><span class="token punctuation">=</span><span class="token boolean">true</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Related features</span></span>
<span class="line"><span class="token key property">ALLOW_PASSKEY_ENROLLMENT</span><span class="token punctuation">=</span><span class="token boolean">false</span>   <span class="token comment"># enable passkey enrollment flows</span></span>
<span class="line"><span class="token key property">ENABLE_RECOVERY_CODE</span><span class="token punctuation">=</span><span class="token boolean">false</span>       <span class="token comment"># enable recovery codes</span></span>
<span class="line"><span class="token key property">ENABLE_MFA_REMEMBER_DEVICE</span><span class="token punctuation">=</span><span class="token boolean">false</span> <span class="token comment"># allow users to remember device for 30 days</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>If any of OTP_MFA_IS_REQUIRED, EMAIL_MFA_IS_REQUIRED, or SMS_MFA_IS_REQUIRED is true, that factor is required at sign-in.</li><li>When all three are false, ENFORCE_ONE_MFA_ENROLLMENT can require users to enroll at least one factor from the allowed list.</li><li>Configure your Email/SMS providers before enabling those MFA types.</li></ul><h2 id="enrollment-options" tabindex="-1"><a class="header-anchor" href="#enrollment-options"><span>Enrollment options</span></a></h2><ul><li>Admin Panel: Admins can enroll or unenroll MFA and manage recovery options.</li><li>S2S API: Drive enrollment flows programmatically from your backend.</li><li>Embedded Auth API: Drive enrollment flows programmatically from your frontend.</li></ul><h2 id="passkey" tabindex="-1"><a class="header-anchor" href="#passkey"><span>Passkey</span></a></h2><p>Passkeys provide secure, phishing-resistant sign-in without passwords and allow users to bypass MFA. Enable enrollment via:</p><ul><li>Enable via ALLOW_PASSKEY_ENROLLMENT=true</li></ul><h2 id="recovery-codes" tabindex="-1"><a class="header-anchor" href="#recovery-codes"><span>Recovery codes</span></a></h2><p>Recovery codes let users regain access when they forget their password or cannot complete MFA.</p><ul><li>Enable via ENABLE_RECOVERY_CODE=true</li></ul><h2 id="remember-this-device-30-days" tabindex="-1"><a class="header-anchor" href="#remember-this-device-30-days"><span>Remember this device (30 days)</span></a></h2><p>Users can choose to bypass MFA on a trusted device for 30 days.</p><ul><li>Enable via ENABLE_MFA_REMEMBER_DEVICE=true</li></ul><h2 id="app-level-mfa-configuration" tabindex="-1"><a class="header-anchor" href="#app-level-mfa-configuration"><span>App-level MFA configuration</span></a></h2><p>Override MFA behavior per application (client) rather than globally.</p><ul><li>Admin Panel: Open the target app and configure MFA requirements (e.g., required factors, email as backup).</li><li>S2S API: Update an appâ€™s MFA configuration programmatically.</li></ul><p>This is useful when different apps require different assurance levels (e.g., stricter MFA for internal admin apps). However, it will be conflicting with the ENFORCE_ONE_MFA_ENROLLMENT setting, so you need to carefully consider the impact. <img src="https://raw.githubusercontent.com/ValueMelody/melody-auth/main/docs/images/app_level_mfa.jpg" alt="App-level MFA"></p><h2 id="related-policies-shortcuts" tabindex="-1"><a class="header-anchor" href="#related-policies-shortcuts"><span>Related policies (shortcuts)</span></a></h2><p>You can route directly to certain flows via policies:</p><ul><li><code>reset_mfa</code>: Reset enrolled MFA</li><li><code>manage_recovery_code</code>: Manage recovery codes</li><li><code>manage_passkey</code>: Manage passkeys</li></ul>`,24)]))}const p=a(t,[["render",i]]),c=JSON.parse('{"path":"/mfa-setup.html","title":"Multi-Factor Authentication (MFA) Setup","lang":"en-US","frontmatter":{},"git":{"updatedTime":1754954867000,"contributors":[{"name":"Baozier","username":"Baozier","email":"byn9826@gmail.com","commits":1,"url":"https://github.com/Baozier"}],"changelog":[{"hash":"8072502fc071765c4d8e2ab6e797919d78d7c086","time":1754954867000,"email":"byn9826@gmail.com","author":"Baozier","message":"Regroup docs (#420)"}]},"filePathRelative":"mfa-setup.md"}');export{p as comp,c as data};
