import{_ as n,c as a,a as t,o as e}from"./app-Bs8I1UkO.js";const p={};function o(l,s){return e(),a("div",null,s[0]||(s[0]=[t(`<h1 id="next-js-sdk" tabindex="-1"><a class="header-anchor" href="#next-js-sdk"><span>Next.js SDK</span></a></h1><p>The Next.js SDK allows you to easily integrate Melody Auth into your Next.js applications with server-side rendering support, middleware protection, and cookie-based storage.</p><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">npm</span> <span class="token function">install</span> @melody-auth/nextjs <span class="token parameter variable">--save</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="nextauthprovider" tabindex="-1"><a class="header-anchor" href="#nextauthprovider"><span>NextAuthProvider</span></a></h2><p>Wrap your application inside NextAuthProvider component to provide the auth related context to your application components.</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>clientId</td><td>string</td><td>The auth clientId your frontend connects to</td><td>N/A</td><td>Yes</td></tr><tr><td>redirectUri</td><td>string</td><td>The URL to redirect users after successful authentication</td><td>N/A</td><td>Yes</td></tr><tr><td>serverUrl</td><td>string</td><td>The URL where you host the melody auth server</td><td>N/A</td><td>Yes</td></tr><tr><td>storage</td><td>&#39;cookieStorage&#39; | &#39;localStorage&#39; | &#39;sessionStorage&#39;</td><td>Storage type for authentication tokens</td><td>&#39;cookieStorage&#39;</td><td>No</td></tr><tr><td>cookieOptions</td><td>CookieOptions</td><td>Cookie configuration options</td><td>{}</td><td>No</td></tr><tr><td>scopes</td><td>string[]</td><td>Permission scopes to request for user access</td><td>[&#39;openid&#39;, &#39;profile&#39;, &#39;email&#39;]</td><td>No</td></tr></tbody></table><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NextAuthProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">RootLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NextAuthProvider</span></span></span>
<span class="line">        <span class="token attr-name">clientId</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_CLIENT_ID</span> <span class="token operator">??</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span></span>
<span class="line">        <span class="token attr-name">redirectUri</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_REDIRECT_URI</span> <span class="token operator">??</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span></span>
<span class="line">        <span class="token attr-name">serverUrl</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_SERVER_URL</span> <span class="token operator">??</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span></span>
<span class="line">        <span class="token attr-name">storage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cookieStorage<span class="token punctuation">&quot;</span></span></span>
<span class="line">      <span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">          </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NextAuthProvider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="createmelodyauthmiddleware" tabindex="-1"><a class="header-anchor" href="#createmelodyauthmiddleware"><span>createMelodyAuthMiddleware</span></a></h2><p>Creates a Next.js middleware function that protects routes with JWT verification.</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th><th>Default</th><th>Required</th></tr></thead><tbody><tr><td>publicKey</td><td>string</td><td>PEM-encoded RSA public key for JWT verification</td><td>N/A</td><td>No*</td></tr><tr><td>jwksUri</td><td>string</td><td>URI to fetch JWKS for JWT verification</td><td>N/A</td><td>No*</td></tr><tr><td>publicPaths</td><td>string[]</td><td>Array of path prefixes that don&#39;t require authentication</td><td>[]</td><td>No</td></tr><tr><td>redirectPath</td><td>string</td><td>Path to redirect unauthenticated users</td><td>&#39;/login&#39;</td><td>No</td></tr><tr><td>cookieOptions</td><td>CookieOptions</td><td>Cookie configuration options</td><td>{}</td><td>No</td></tr></tbody></table><p>*Either <code>publicKey</code> or <code>jwksUri</code> is required.</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createMelodyAuthMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createMelodyAuthMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  jwksUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AUTH_JWKS_URI</span><span class="token punctuation">,</span></span>
<span class="line">  publicPaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/register&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/api/public&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  redirectPath<span class="token operator">:</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  matcher<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;/((?!_next/static|_next/image|favicon.ico).*)&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="usenextauth" tabindex="-1"><a class="header-anchor" href="#usenextauth"><span>useNextAuth</span></a></h2><p>A React hook that provides authentication state and methods for client components.</p><p>Returns an object containing:</p><ul><li><code>isAuthenticated</code>: boolean - Whether user is authenticated</li><li><code>isAuthenticating</code>: boolean - Loading state during auth</li><li><code>authenticationError</code>: string - Authentication error message</li><li><code>userInfo</code>: object - User profile information</li><li><code>account</code>: object - JWT account claims</li><li><code>accessToken</code>: string | null - Current access token</li><li><code>idToken</code>: string | null - Current ID token</li><li><code>isLoadingUserInfo</code>: boolean - Loading state for user info</li><li><code>acquireUserInfoError</code>: string - User info fetch error</li><li><code>isLoadingToken</code>: boolean - Loading state for tokens</li><li><code>acquireTokenError</code>: string - Token acquisition error</li><li><code>loginError</code>: string - Login error message</li><li><code>logoutError</code>: string - Logout error message</li><li><code>loginRedirect()</code>: function - Redirect to login</li><li><code>logoutRedirect()</code>: function - Logout and redirect</li><li><code>refreshSession()</code>: function - Force token refresh</li></ul><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> useNextAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> isAuthenticated<span class="token punctuation">,</span> account<span class="token punctuation">,</span> loginRedirect<span class="token punctuation">,</span> logoutRedirect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useNextAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">loginRedirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Login</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Welcome, </span><span class="token punctuation">{</span>account<span class="token operator">?.</span>email<span class="token punctuation">}</span><span class="token plain-text">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">logoutRedirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Logout</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="getserversession" tabindex="-1"><a class="header-anchor" href="#getserversession"><span>getServerSession</span></a></h2><p>Retrieves the current user session from cookies in server components. Returns null if not authenticated.</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td>options</td><td>ServerAuthOptions</td><td>Configuration object</td><td>Yes</td></tr></tbody></table><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getServerSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">ProfilePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getServerSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_CLIENT_ID</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    serverUrl<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_SERVER_URL</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    redirectUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_REDIRECT_URI</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Profile</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">User ID: </span><span class="token punctuation">{</span>session<span class="token punctuation">.</span>userId<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Email: </span><span class="token punctuation">{</span>session<span class="token punctuation">.</span>email<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="requireauth" tabindex="-1"><a class="header-anchor" href="#requireauth"><span>requireAuth</span></a></h2><p>Ensures the user is authenticated, throws an error if not. Useful for protecting API routes.</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td>options</td><td>ServerAuthOptions</td><td>Configuration object</td><td>Yes</td></tr><tr><td>redirectTo</td><td>string</td><td>Path to suggest for redirection</td><td>No</td></tr></tbody></table><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> requireAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requireAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_CLIENT_ID</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    serverUrl<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_SERVER_URL</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    redirectUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_REDIRECT_URI</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>session<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    userId<span class="token operator">:</span> session<span class="token punctuation">.</span>userId</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advanced-usage" tabindex="-1"><a class="header-anchor" href="#advanced-usage"><span>Advanced Usage</span></a></h2><h3 id="custom-cookie-options" tabindex="-1"><a class="header-anchor" href="#custom-cookie-options"><span>Custom Cookie Options</span></a></h3><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NextAuthProvider</span></span></span>
<span class="line">  <span class="token attr-name">clientId</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_CLIENT_ID</span><span class="token operator">!</span><span class="token punctuation">}</span></span></span>
<span class="line">  <span class="token attr-name">serverUrl</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_SERVER_URL</span><span class="token operator">!</span><span class="token punctuation">}</span></span></span>
<span class="line">  <span class="token attr-name">redirectUri</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_REDIRECT_URI</span><span class="token operator">!</span><span class="token punctuation">}</span></span></span>
<span class="line">  <span class="token attr-name">storage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cookie<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">cookieOptions</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></span>
<span class="line">    httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    secure<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    sameSite<span class="token operator">:</span> <span class="token string">&#39;lax&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    path<span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    maxAge<span class="token operator">:</span> <span class="token number">86400</span> <span class="token comment">// 24 hours</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">}</span></span></span>
<span class="line"><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">  </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NextAuthProvider</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="using-localstorage-sessionstorage" tabindex="-1"><a class="header-anchor" href="#using-localstorage-sessionstorage"><span>Using localStorage/sessionStorage</span></a></h3><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token comment">// Use localStorage instead of cookies</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NextAuthProvider</span></span></span>
<span class="line">  <span class="token attr-name">clientId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">serverUrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">redirectUri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span></span>
<span class="line">  <span class="token attr-name">storage</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localStorage<span class="token punctuation">&quot;</span></span> <span class="token comment">// or &quot;sessionStorage&quot;</span></span>
<span class="line"><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">  </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NextAuthProvider</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="advanced-middleware-configuration" tabindex="-1"><a class="header-anchor" href="#advanced-middleware-configuration"><span>Advanced Middleware Configuration</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// middleware.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createMelodyAuthMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createMelodyAuthMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  jwksUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AUTH_JWKS_URI</span><span class="token punctuation">,</span></span>
<span class="line">  publicPaths<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&#39;/login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;/register&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;/api/public&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;/api/webhooks&#39;</span> <span class="token comment">// Public API routes</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  redirectPath<span class="token operator">:</span> <span class="token string">&#39;/auth/login&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  cookieOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    secure<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    sameSite<span class="token operator">:</span> <span class="token string">&#39;strict&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="custom-middleware-with-auth-context" tabindex="-1"><a class="header-anchor" href="#custom-middleware-with-auth-context"><span>Custom Middleware with Auth Context</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> withAuth <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;next/server&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withAuth</span><span class="token punctuation">(</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Access authenticated user info</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">{</span> userId<span class="token punctuation">,</span> email <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>auth<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Custom logic based on user</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>email<span class="token operator">?.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;@company.com&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token string">&#39;/unauthorized&#39;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    jwksUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">AUTH_JWKS_URI</span><span class="token punctuation">,</span></span>
<span class="line">    publicPaths<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cached-server-sessions" tabindex="-1"><a class="header-anchor" href="#cached-server-sessions"><span>Cached Server Sessions</span></a></h3><div class="language-tsx line-numbers-mode" data-highlighter="prismjs" data-ext="tsx"><pre><code class="language-tsx"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> getCachedServerSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@melody-auth/nextjs&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Caches session for the request lifecycle</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">Layout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCachedServerSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_CLIENT_ID</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    serverUrl<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_SERVER_URL</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">    redirectUri<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_AUTH_REDIRECT_URI</span><span class="token operator">!</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"></span>
<span class="line">      </span><span class="token punctuation">{</span>session <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserMenu</span></span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>session<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="line">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api-reference" tabindex="-1"><a class="header-anchor" href="#api-reference"><span>API Reference</span></a></h2><h3 id="nextauthprovider-props" tabindex="-1"><a class="header-anchor" href="#nextauthprovider-props"><span>NextAuthProvider Props</span></a></h3><table><thead><tr><th>Prop</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>serverUrl</td><td>string</td><td>required</td><td>Your Melody Auth server URL</td></tr><tr><td>clientId</td><td>string</td><td>required</td><td>OAuth client ID</td></tr><tr><td>redirectUri</td><td>string</td><td>required</td><td>OAuth redirect URI</td></tr><tr><td>storage</td><td>&#39;cookie&#39; | &#39;localStorage&#39; | &#39;sessionStorage&#39;</td><td>&#39;cookie&#39;</td><td>Storage mechanism</td></tr><tr><td>cookieOptions</td><td>CookieOptions</td><td>{}</td><td>Cookie configuration</td></tr><tr><td>scope</td><td>string</td><td>&#39;openid profile email&#39;</td><td>OAuth scopes</td></tr></tbody></table><h3 id="cookieoptions" tabindex="-1"><a class="header-anchor" href="#cookieoptions"><span>CookieOptions</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">CookieOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  httpOnly<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>     <span class="token comment">// Default: true</span></span>
<span class="line">  secure<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>       <span class="token comment">// Default: NODE_ENV === &#39;production&#39;</span></span>
<span class="line">  sameSite<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&#39;lax&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;strict&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span> <span class="token comment">// Default: &#39;lax&#39;</span></span>
<span class="line">  path<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>          <span class="token comment">// Default: &#39;/&#39;</span></span>
<span class="line">  domain<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  maxAge<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>        <span class="token comment">// In seconds</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="usenextauth-hook" tabindex="-1"><a class="header-anchor" href="#usenextauth-hook"><span>useNextAuth Hook</span></a></h3><p>Returns an object with:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">NextAuthHook</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Auth state</span></span>
<span class="line">  isAuthenticated<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  isAuthenticating<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  userInfo<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></span>
<span class="line">  account<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></span>
<span class="line">  idToken<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  accessToken<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Loading states</span></span>
<span class="line">  isLoadingUserInfo<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  isLoadingToken<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Error states</span></span>
<span class="line">  authenticationError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  acquireUserInfoError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  acquireTokenError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  loginError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  logoutError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Methods</span></span>
<span class="line">  <span class="token function-variable function">loginRedirect</span><span class="token operator">:</span> <span class="token punctuation">(</span>request<span class="token operator">?</span><span class="token operator">:</span> LoginRedirectRequest<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function-variable function">logoutRedirect</span><span class="token operator">:</span> <span class="token punctuation">(</span>request<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> returnTo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function-variable function">refreshSession</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="middleware-config" tabindex="-1"><a class="header-anchor" href="#middleware-config"><span>Middleware Config</span></a></h3><table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>publicKey</td><td>string</td><td>PEM-encoded RSA public key</td></tr><tr><td>jwksUri</td><td>string</td><td>JWKS endpoint URL (recommended)</td></tr><tr><td>publicPaths</td><td>string[]</td><td>Paths that don&#39;t require auth</td></tr><tr><td>redirectPath</td><td>string</td><td>Where to redirect unauthenticated users</td></tr><tr><td>cookieOptions</td><td>CookieOptions</td><td>Cookie configuration</td></tr></tbody></table><h3 id="server-functions" tabindex="-1"><a class="header-anchor" href="#server-functions"><span>Server Functions</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Get session in server components</span></span>
<span class="line"><span class="token function">getServerSession</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ServerAuthOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AuthSession <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Require auth (throws if not authenticated)</span></span>
<span class="line"><span class="token function">requireAuth</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ServerAuthOptions<span class="token punctuation">,</span> redirectTo<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AuthSession<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Get cached session (cached for request lifecycle)</span></span>
<span class="line"><span class="token function">getCachedServerSession</span><span class="token punctuation">(</span>options<span class="token operator">:</span> ServerAuthOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AuthSession <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="serverauthoptions" tabindex="-1"><a class="header-anchor" href="#serverauthoptions"><span>ServerAuthOptions</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">ServerAuthOptions</span> <span class="token punctuation">{</span></span>
<span class="line">  clientId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  serverUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  redirectUri<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  cookieOptions<span class="token operator">?</span><span class="token operator">:</span> CookieOptions<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="authsession" tabindex="-1"><a class="header-anchor" href="#authsession"><span>AuthSession</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">AuthSession</span> <span class="token punctuation">{</span></span>
<span class="line">  userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  email<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  account<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>          <span class="token comment">// Full JWT payload</span></span>
<span class="line">  accessToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  idToken<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  isAuthenticated<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// Always true for valid sessions</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cookie-storage" tabindex="-1"><a class="header-anchor" href="#cookie-storage"><span>Cookie Storage</span></a></h2><p>The SDK uses cookies by default for server-side compatibility. Key features:</p><ul><li><strong>Secure by default</strong> - httpOnly, secure, sameSite protection</li><li><strong>Large token handling</strong> - Automatically chunks tokens if needed</li><li><strong>Server/client sync</strong> - Works seamlessly across SSR and CSR</li><li><strong>Automatic cleanup</strong> - Old tokens are cleaned up on updates</li></ul><h3 id="how-cookie-storage-works" tabindex="-1"><a class="header-anchor" href="#how-cookie-storage-works"><span>How Cookie Storage Works</span></a></h3><ol><li><strong>Token Storage</strong>: JWT tokens are stored in secure, httpOnly cookies</li><li><strong>Chunking</strong>: Large tokens are automatically split across multiple cookies</li><li><strong>Reassembly</strong>: Chunks are automatically reassembled when reading</li><li><strong>Cleanup</strong>: Old chunks are removed when tokens are updated</li></ol><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><h3 id="common-issues" tabindex="-1"><a class="header-anchor" href="#common-issues"><span>Common Issues</span></a></h3><p><strong>Middleware not working</strong></p><ul><li>Ensure <code>AUTH_JWKS_URI</code> or <code>AUTH_PUBLIC_KEY</code> is set</li><li>Check that middleware matcher includes the protected routes</li><li>Verify JWKS endpoint is accessible from your deployment environment</li></ul><p><strong>Session not persisting</strong></p><ul><li>Make sure you&#39;re using cookie storage for SSR</li><li>Check that cookies are not being blocked by browser settings</li><li>Verify cookie options (secure, sameSite) match your deployment</li></ul><p><strong>Token refresh failing</strong></p><ul><li>Ensure refresh tokens are being stored (requires cookie storage)</li><li>Check that the serverUrl and redirectUri are correct</li><li>Verify the Melody Auth server is configured for refresh tokens</li></ul><h2 id="examples" tabindex="-1"><a class="header-anchor" href="#examples"><span>Examples</span></a></h2><p>Complete examples are available in the <a href="https://github.com/ValueMelody/melody-auth-examples" target="_blank" rel="noopener noreferrer">melody-auth-examples</a> repository:</p><ul><li>App Router setup</li><li>Pages Router setup</li><li>API route protection</li><li>Server component auth</li><li>Client component auth</li><li>Middleware configuration</li></ul>`,69)]))}const c=n(p,[["render",o]]),r=JSON.parse('{"path":"/nextjs-sdk.html","title":"Next.js SDK","lang":"en-US","frontmatter":{},"git":{"updatedTime":1758151825000,"contributors":[{"name":"WERDXZ","username":"WERDXZ","email":"73824809+WERDXZ@users.noreply.github.com","commits":1,"url":"https://github.com/WERDXZ"}],"changelog":[{"hash":"ba6f688c71cbbbe073d570fafd7baea83524b41f","time":1758151825000,"email":"73824809+WERDXZ@users.noreply.github.com","author":"Jiqing Yang","message":"Nextjs Support (#408)"}]},"filePathRelative":"nextjs-sdk.md"}');export{c as comp,r as data};
