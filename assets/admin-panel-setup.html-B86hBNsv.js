import{_ as a,c as n,a as t,o as l}from"./app-1vP9sU5Z.js";const i={};function s(r,e){return l(),n("div",null,e[0]||(e[0]=[t(`<h1 id="admin-panel" tabindex="-1"><a class="header-anchor" href="#admin-panel"><span>Admin Panel</span></a></h1><p>Follow these instructions to set up and run the admin panel locally or in production.</p><h2 id="_1-prerequisites" tabindex="-1"><a class="header-anchor" href="#_1-prerequisites"><span>1. Prerequisites</span></a></h2><p>Complete the auth server setup first.</p><h2 id="_2-get-started" tabindex="-1"><a class="header-anchor" href="#_2-get-started"><span>2. Get Started</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd melody-auth/admin-panel</span>
<span class="line">cp .env.example .env</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-update-the-env-file-with-the-following-variables" tabindex="-1"><a class="header-anchor" href="#_3-update-the-env-file-with-the-following-variables"><span>3. Update the .env file with the following variables:</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">NEXT_PUBLIC_CLIENT_URI: Set this to the host url of your admin panel app</span>
<span class="line">NEXT_PUBLIC_SERVER_URI: Set this to the host url of your auth server.</span>
<span class="line">NEXT_PUBLIC_CLIENT_ID: Client ID for the Admin Panel (SPA) app</span>
<span class="line">SERVER_CLIENT_ID: Client ID for the Admin Panel (S2S) app</span>
<span class="line">SERVER_CLIENT_SECRET: Client secret for the Admin Panel (S2S) app</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>For Cloudflare remote/production environment, you can find the necessary information in the Cloudflare dashboard under &quot;Workers &amp; Pages&quot; -&gt; D1 -&gt; Melody Auth database -&gt; app table.</li><li>For Cloudflare local/development environment, use the following command to retrieve app information:<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd melody-auth/server</span>
<span class="line">wrangler d1 execute melody-auth --command=&quot;select * from app&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>For NodeJS environment, check your Postgres melody-auth database -&gt; app table</li></ul><h2 id="_4-start-the-admin-panel-app" tabindex="-1"><a class="header-anchor" href="#_4-start-the-admin-panel-app"><span>4. Start the admin panel app</span></a></h2><p>Start the admin panel app</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd melody-auth/admin-panel</span>
<span class="line">npm install</span>
<span class="line">npm run dev</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="first-time-setup" tabindex="-1"><a class="header-anchor" href="#first-time-setup"><span>First-time Setup</span></a></h3><ol><li>When you first access the admin panel, you&#39;ll be redirected to the auth server login screen. Create a new account.</li><li>After creating an account, you&#39;ll be redirected back to the admin panel with an &quot;super_admin role required&quot; alert. This is expected for new accounts.</li><li>To grant super admin access: <ul><li>For Cloudflare remote/production environment: <ol><li>Go to the Cloudflare dashboard</li><li>Navigate to &quot;Workers &amp; Pages&quot; -&gt; D1 -&gt; Melody Auth database -&gt; user_role table</li><li>Add a new record with userId = 1 and roleId = 1 (assuming you just created the first user)</li></ol></li><li>For Cloudflare local/development environment:<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd melody-auth/server</span>
<span class="line">wrangler d1 execute melody-auth --command=&quot;insert into user_role (userId, roleId) values (1, 1)&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>For NodeJS environment, insert following record to your Postgres melody-auth database:<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">insert into user_role (userId, roleId) values (1, 1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li>Logout (Required after update user role) and login again. You should now have full access.</li></ol><h3 id="deploy-admin-panel-to-cloudflare-workers" tabindex="-1"><a class="header-anchor" href="#deploy-admin-panel-to-cloudflare-workers"><span>Deploy Admin Panel to Cloudflare Workers</span></a></h3><p>The Admin Panel is a full-stack Next.js application typically deployed in a Node.js environment. Deployment to Cloudflare Workers is now supported via the opennextjs-cloudflare package.</p><p>Steps to Deploy:</p><ol><li>Create a new worker named &quot;melody-auth-admin-panel&quot;</li><li>Go to &quot;melody-auth-admin-panel&quot; Cloudflare Dashboard -&gt; Settings -&gt; Variables and Secrets, add following secrets<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">SERVER_CLIENT_ID=[Client ID for the Admin Panel (S2S) app]</span>
<span class="line">SERVER_CLIENT_SECRET=[Client secret for the Admin Panel (S2S) app]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>In your project directory, under the /admin-panel folder, create an .env file:<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">NEXT_PUBLIC_CLIENT_URI=[The host url of this admin panel worker]</span>
<span class="line">NEXT_PUBLIC_SERVER_URI=[The host url of your auth server]</span>
<span class="line">NEXT_PUBLIC_CLIENT_ID=[Client ID for the Admin Panel (SPA) app]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>Build the project<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">npm run cf:build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>Deploy<div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">npm run cf:deploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol>`,18)]))}const o=a(i,[["render",s],["__file","admin-panel-setup.html.vue"]]),p=JSON.parse('{"path":"/admin-panel-setup.html","title":"Admin Panel","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"1. Prerequisites","slug":"_1-prerequisites","link":"#_1-prerequisites","children":[]},{"level":2,"title":"2. Get Started","slug":"_2-get-started","link":"#_2-get-started","children":[]},{"level":2,"title":"3. Update the .env file with the following variables:","slug":"_3-update-the-env-file-with-the-following-variables","link":"#_3-update-the-env-file-with-the-following-variables","children":[]},{"level":2,"title":"4. Start the admin panel app","slug":"_4-start-the-admin-panel-app","link":"#_4-start-the-admin-panel-app","children":[{"level":3,"title":"First-time Setup","slug":"first-time-setup","link":"#first-time-setup","children":[]},{"level":3,"title":"Deploy Admin Panel to Cloudflare Workers","slug":"deploy-admin-panel-to-cloudflare-workers","link":"#deploy-admin-panel-to-cloudflare-workers","children":[]}]}],"git":{"updatedTime":1739055609000,"contributors":[{"name":"Baozier","username":"Baozier","email":"byn9826@gmail.com","commits":6,"url":"https://github.com/Baozier"}]},"filePathRelative":"admin-panel-setup.md"}');export{o as comp,p as data};
