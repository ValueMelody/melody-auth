import{_ as e,c as s,a as n,o as i}from"./app-BBM0DsjG.js";const l={};function t(r,a){return i(),s("div",null,a[0]||(a[0]=[n(`<h1 id="用户属性" tabindex="-1"><a class="header-anchor" href="#用户属性"><span>用户属性</span></a></h1><p>用户属性允许你捕获和管理用户的自定义数据字段，这些字段超出了标准字段（如email 等）。该功能使你能够在注册过程中收集额外信息，并将其包含在认证 token 或用户档案数据中。</p><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>用户属性提供了一种灵活的方式来：</p><ul><li>在用户注册时收集自定义信息</li><li>在 ID token 中包含自定义数据</li><li>通过 user info 接口返回自定义数据</li><li>支持属性标签的多语言</li><li>在注册时强制要求必填字段</li></ul><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><h3 id="启用用户属性" tabindex="-1"><a class="header-anchor" href="#启用用户属性"><span>启用用户属性</span></a></h3><p>要启用用户属性功能，请在 <code>server/wrangler.toml</code> 中设置以下配置：</p><div class="language-toml line-numbers-mode" data-highlighter="prismjs" data-ext="toml"><pre><code class="language-toml"><span class="line"><span class="token punctuation">[</span><span class="token table class-name">vars</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token key property">ENABLE_USER_ATTRIBUTE</span> <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>此配置将：</p><ul><li>在管理面板中启用用户属性管理</li><li>允许在注册表单中包含用户属性</li><li>启用 S2S API 接口以管理用户属性</li></ul><h2 id="管理用户属性" tabindex="-1"><a class="header-anchor" href="#管理用户属性"><span>管理用户属性</span></a></h2><h3 id="管理面板界面" tabindex="-1"><a class="header-anchor" href="#管理面板界面"><span>管理面板界面</span></a></h3><p>启用后，你可以通过管理面板管理用户属性：</p><ol><li><strong>进入用户属性</strong>：访问管理面板中的用户属性部分</li><li><strong>创建新属性</strong>：点击 “Create” 添加新的用户属性</li><li><strong>配置属性</strong>：使用以下选项设置属性： <ul><li><strong>Name</strong>（必填）：属性的内部标识符</li><li><strong>Locales</strong>：该属性的多语言显示标签</li><li><strong>Include in Sign Up Form</strong>：该属性是否出现在用户注册表单中</li><li><strong>Required in Sign Up Form</strong>：用户注册时是否必须填写该属性</li><li><strong>Include in ID Token Body</strong>：该属性是否包含在 JWT ID token 的 payload 中</li><li><strong>Include in User Info</strong>：该属性是否通过 user info 接口返回</li></ul></li></ol><p><img src="https://raw.githubusercontent.com/ValueMelody/melody-auth/main/docs/images/user_attributes.jpg" alt="用户属性"></p><h3 id="s2s-api-管理" tabindex="-1"><a class="header-anchor" href="#s2s-api-管理"><span>S2S API 管理</span></a></h3><p>可以通过 S2S API 接口以编程方式管理用户属性：</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http"><pre><code class="language-http"><span class="line">GET /api/v1/user-attributes: 获取所有用户属性</span>
<span class="line">GET /api/v1/user-attributes/{id}: 获取指定用户属性</span>
<span class="line">POST /api/v1/user-attributes: 创建新的用户属性</span>
<span class="line">PUT /api/v1/user-attributes/{id}: 更新已有用户属性</span>
<span class="line">DELETE /api/v1/user-attributes/{id}: 删除用户属性</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注册表单集成" tabindex="-1"><a class="header-anchor" href="#注册表单集成"><span>注册表单集成</span></a></h2><p>当 <code>includeInSignUpForm</code> 启用时，用户属性会自动显示在注册表单中：</p><ul><li>属性会以文本输入框的形式显示</li><li>标签会根据用户选择的语言进行本地化</li><li>必填属性会被标记并在提交时验证</li><li>属性与标准注册数据一并收集</li></ul><p>合适的标签会基于以下规则显示：</p><ul><li>用户当前选择的语言</li><li>如果找不到匹配的语言，则回退为属性的 <code>name</code></li></ul><h2 id="id-token-集成" tabindex="-1"><a class="header-anchor" href="#id-token-集成"><span>ID Token 集成</span></a></h2><p>当 <code>includeInIdTokenBody</code> 启用时：</p><ul><li>用户属性值会包含在 JWT ID token 的 payload 中</li><li>属性会以 key-value 形式显示，key 为属性名称</li><li>仅添加标记为需要包含在 ID token 中的属性</li></ul><h2 id="user-info-接口" tabindex="-1"><a class="header-anchor" href="#user-info-接口"><span>User Info 接口</span></a></h2><p>当 <code>includeInUserInfo</code> 启用时：</p><ul><li>用户属性会通过 <code>/userinfo</code> 接口返回</li><li>属性会出现在响应的 <code>attributes</code> 对象中</li><li>仅返回标记为需要包含在 user info 中的属性</li></ul>`,30)]))}const d=e(l,[["render",t]]),p=JSON.parse('{"path":"/zh/user-attributes.html","title":"用户属性","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1755219196000,"contributors":[{"name":"Baozier","username":"Baozier","email":"byn9826@gmail.com","commits":1,"url":"https://github.com/Baozier"}],"changelog":[{"hash":"48aef26b66375de4db0d1c4e18eeafe5a6ba159a","time":1755219196000,"email":"byn9826@gmail.com","author":"Baozier","message":"Add docs for org groups, user attributes, and log management (#427)"}]},"filePathRelative":"zh/user-attributes.md"}');export{d as comp,p as data};
